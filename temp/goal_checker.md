Nav2에서 제공하는 3가지 Goal Checker 플러그인은 **"로봇이 목표 지점에 도착했다고 판단하는 기준"**이 서로 다릅니다.

제공해주신 코드를 바탕으로 각각의 작동 방식과 핵심 차이점을 분석해 드립니다.

---

### 1. 요약 비교 (Comparison Table)

| 특성 | **SimpleGoalChecker** | **StoppedGoalChecker** | **PositionGoalChecker** |
| --- | --- | --- | --- |
| **확인 항목** | 위치(XY) + 각도(Yaw) | 위치(XY) + 각도(Yaw) + **속도(Velocity)** | **위치(XY)만 확인** |
| **각도(Yaw) 검사** | O (필수) | O (필수) | **X (무시함)** |
| **정지 여부 검사** | X (지나가도 성공 가능) | **O (완전히 멈춰야 성공)** | X |
| **Stateful (Latch)** | O (XY 만족 후엔 각도만 봄) | O (Simple 상속) | O (한 번 닿으면 계속 성공) |
| **주 사용처** | 일반적인 목적지 도착 | 정밀 주차, 작업 전 정지 | 경유지(Waypoint), 회전 불필요 시 |

---

### 2. 상세 분석

#### 1) `SimpleGoalChecker` (가장 기본적이고 범용적)

가장 표준적인 검사기입니다. **"지정된 위치 근처에 가서, 지정된 방향을 바라보면 성공"**으로 간주합니다.

* **체크 기준:**
1. **위치(XY):** 현재 위치가 목표점 반경(`xy_goal_tolerance`) 내에 있는가?
2. **각도(Yaw):** 현재 헤딩이 목표 헤딩(`yaw_goal_tolerance`) 내에 있는가?


* **Stateful (중요):**
* 이 옵션이 `true`이면, 로봇이 한 번 **XY 위치 범위** 안에 들어오는 순간 **"위치 검사 완료(XY Check Passed)"** 상태로 고정(Latch)됩니다.
* 이후 제자리 회전(Final Rotation) 중에 로봇이 미세하게 밀려서 XY 범위를 살짝 벗어나더라도, **위치 오차는 무시하고 각도(Yaw)만 맞으면 성공**으로 처리합니다. (사용자님이 겪으신 진동 문제를 완화하는 핵심 기능입니다.)



#### 2) `StoppedGoalChecker` (완전 정지 보장)

`SimpleGoalChecker`를 상속받아 기능을 확장한 클래스입니다. **"위치랑 각도도 맞아야 하고, 로봇이 완전히 멈춰 있어야 성공"**으로 간주합니다.

* **체크 기준:**
1. `SimpleGoalChecker`의 조건(XY + Yaw)을 모두 만족해야 함.
2. **추가 조건:** 현재 로봇의 선속도와 각속도가 설정된 `stopped_velocity` 이하로 떨어져야 함.


* **특징:**
* 로봇이 목표 지점을 스쳐 지나가는 것을 "성공"으로 보지 않습니다.
* **진동 문제 시 주의:** 만약 제어기가 목표 지점에서 미세하게 떨리며(Oscillation) 속도가 0이 되지 않는다면, 이 체커는 영원히 `Goal Reached`를 띄우지 않을 수 있습니다.



#### 3) `PositionGoalChecker` (위치만 중요할 때)

매우 단순화된 검사기입니다. **"방향은 상관없고, 저 위치에 발만 담그면 성공"**으로 간주합니다.

* **체크 기준:**
1. **위치(XY):** 오직 XY 좌표가 오차 범위(`xy_goal_tolerance`) 내에 있는지만 봅니다.
2. **각도(Yaw):** **검사하지 않습니다.** (코드상 `vel_tolerance.angular.z` 등을 무효화 처리함)


* **Stateful:**
* 한 번이라도 해당 위치를 스치면 `position_reached_ = true`가 되어, 이후 로봇이 어디로 가든 계속 성공 상태를 유지합니다(Reset 전까지).


* **사용처:**
* 최종 목적지가 아닌 **경유지(Waypoint)**를 지나갈 때 유용합니다. (멈추거나 회전하지 않고 부드럽게 지나감)
* 전방향 로봇(Omni-directional)이 아닌 경우, 굳이 최종 자세를 맞출 필요가 없는 단순 이동 명령에 적합합니다.



---

### 3. 사용자님 상황에 비춰본 결론

사용자님은 **"정밀한 제자리 회전 및 주차"**를 테스트하고 계시므로:

1. **`PositionGoalChecker`**: **부적합합니다.** Yaw(헤딩)를 맞추지 않아도 성공해버리기 때문에, 1도 차이 회전 테스트 자체가 불가능합니다.
2. **`StoppedGoalChecker`**: **가장 엄격합니다.** 로봇이 목표에 도착해서 진동(Oscillation)하고 있다면, 속도가 0이 아니므로 성공 판정이 절대 나지 않습니다. 디버깅에는 좋지만, 제어기가 불안정하면 영원히 끝나지 않을 수 있습니다.
3. **`SimpleGoalChecker`**: **가장 적합합니다.** 특히 `stateful: true` 옵션 덕분에, "위치 도착 -> 제자리 회전 중 위치 밀림 -> 그래도 각도만 맞으면 성공"이라는 로직이 가능하여 현재 상황에서 가장 안정적인 결과를 줄 것입니다.

**추천:** 현재 `SimpleGoalChecker`를 사용 중이신 것으로 보이며, 앞서 제안드린 **Graceful Controller 코드 수정(XY Latch 강화)**과 함께 사용하면 가장 좋은 퍼포먼스를 낼 것입니다.
